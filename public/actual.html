<!DOCTYPE html>
<html lang="en" width="100%" height="100%">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./favicon.ico">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="/scripts/index.js" type="text/javascript"></script>
    
    <style>
        .lc-path {
            fill: none;
            stroke-linejoin: round;
            stroke-linecap: round;
            stroke-width: 3;
        }
        .line-title {
            font-size: 32px;
            font-weight: bold;
        }

    </style>

    <title>Title</title>
</head>
<body width="100%" height="100%">
    <h1 class="className">Hello World</h1>
    <div id="container" style="width: 100%; height:100%">
        <svg id="content"></svg>
    </div>
    <button id="button1">changeDay</button>
    <button id="button2">changeMonth</button>
    <button id="button3">changeYear</button>

    <script>
        var data = 
        {
            "dayCount":[0,2,5,2,1,10,0],
            "monthCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0],
            "yearCount":[0,0,0,0,0,0,0,0,0,0,19,6]
        };

        var margin = {top: 85, right: 20, bottom: 40, left: 80};
        var width = 1100 - margin.right - margin.left;
        var height = 700 - margin.top - margin.bottom;

        // init scales
        var scaleLineX = d3.scaleLinear().rangeRound([0, width]);
        var scaleLineY = d3.scaleLinear().rangeRound([height, 0]);

        // initial dataset
        var lineChartData = data['dayCount'];

        // Create Axes
        var xAxis = d3.axisBottom(scaleLineX).ticks(lineChartData.length).tickFormat(formatDateLabel);
        var yAxis = d3.axisLeft(scaleLineY);

        // Create line function for x,y positions
        var line = d3.line()
            .x(function(d, i) { return scaleLineX(i) })
            .y(function(d, i) { return scaleLineY(d) });

        var lineChart = d3.select("#content")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "0 0 " + (width + margin.left + margin.left) + " " + (height + margin.top + margin.bottom))
            .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        scaleLineX.domain([0, lineChartData.length - 1]);
        scaleLineY.domain([0, d3.max(lineChartData)]);

        // Append the x axis 
        lineChart.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        // Append the Y axis
        lineChart.append("g")
            .attr("class", "axis")
            .call(yAxis);

        // Title
        lineChart.append("g")
            .attr("transform", "translate(" + width * 0.3 + ",-25)")
            .append("text")
                .html("Games Played in Last 7 Days")
                .attr("class", "line-title")

        // Draw the line
        lineChart.append("path")
            .datum(lineChartData)
            .attr("class", "lc-path")
            .attr("d", line)
            .attr("stroke", "#34c");

        // Draw the dots
        lineChart.selectAll(".dot")
            .data(lineChartData)
            .enter()
            .append("circle")
                .attr("r", 5)
                .attr("cx", function(d, i) { return scaleLineX(i) })
                .attr("cy", function(d, i) { return scaleLineY(d) })
                .attr("fill", "#34c")
                .attr("class", "dot");

        function updateLineChart(type) {
            // update data
            var titleText = "";
            var strokeColor = "";
            if (type == "year") {
                lineChartData = data['yearCount'];
                titleText = "Games Played in Last 12 Months";
                strokeColor = "#e44";
            }
            else if (type == "month") {
                lineChartData = data['monthCount'];
                titleText = "Games Played in Last 4 Weeks";
                strokeColor = "#1b7";
            }
            else {
                lineChartData = data['dayCount'];
                titleText = "Games Played in Last 7 Days";
                strokeColor = "#34c";
            }

            // update scales
            scaleLineX.domain([0, lineChartData.length - 1]);
            scaleLineY.domain([0, d3.max(lineChartData)]);

            // Remove old data
            lineChart.selectAll(".axis").remove();
            lineChart.selectAll(".path").remove();
            lineChart.selectAll(".dot").remove();

            // new title
            lineChart.selectAll(".line-title").html(titleText)

            // new X axis 
            xAxis = d3.axisBottom(scaleLineX).ticks(lineChartData.length > 15 ? lineChartData.length / 2 : lineChartData.length).tickFormat(formatDateLabel);
            lineChart.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            // new Y axis
            lineChart.append("g").transition().duration(1000)
                .attr("class", "axis")
                .call(yAxis);

            // new line
            lineChart.select(".lc-path").transition().duration(500)
                .attr("d", line(lineChartData))
                .attr("stroke", strokeColor);

            // New dots
            lineChart.selectAll(".dot")
                .data(lineChartData)
                .enter()
                .append("circle")
                    .attr("r", 0)
                    .attr("cx", function(d, i) { return scaleLineX(i) })
                    .attr("cy", function(d, i) { return scaleLineY(d) })
                    .attr("fill", strokeColor)
                    .attr("class", "dot")
                    .transition().duration(1500)
                        .attr("r", 5);
        }

        function formatDateLabel(d, i) {
            var d = new Date();
            if (lineChartData.length != 12) {
                d.setDate(d.getDate() - (lineChartData.length - 1 - i));
                return d.toLocaleDateString();
            } 
            else {
                var monthArray = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                d.setMonth(d.getMonth() - (lineChartData.length - 1 - i));
                return monthArray[d.getMonth()];
            }
        }

        document.getElementById("button1").onclick = function(e) {
            updateLineChart("day");
        }

        document.getElementById("button2").onclick = function(e) {
            updateLineChart("month");
        }

        document.getElementById("button3").onclick = function(e) {
            updateLineChart("year");
        }


    </script>
</body>
</html>




